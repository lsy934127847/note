[TOC]

## 1. 进程管理

### 1.1 进程

- 进程是正在执行的一个程序或命令，每一个进程都是一个运行的实体，都有自己的地址空间并且用一定的系统资源
- 进程就是正在执行的某个程序

### 1.2 进程管理简介

- 判断服务器的状态
- 查看系统中的所有进程
- 杀死进程，只有无法关闭才要杀死进程

### 1.2 进程的查看命令(ps)

- `ps aux` 查看系统中所有进程，使用BSD操作系统格式
- `ps -le` 查看系统中所有进程，使用Linux标准格式
- TTY是TeleType的一个缩写，原来指的是电传打字机，是通过串行线用打印机键盘通过阅读和发送信息的东西
- pts(pseudo['su:doʊ]-terminal slave)是所谓的伪终端或虚拟终端

#### 1.2.1 选项

| 参数 | 含义                               |
| :--- | :--------------------------------- |
| -a   | 显示一个终端的所有进程             |
| -u   | 显示进程的归属用户及内存的使用情况 |
| -x   | 显示没有控制终端的进程             |
| -l   | 长格式显示，显示更详细的信息       |

#### 1.2.2 结果字段含义 

| 数据    | 含义                                                         |
| :------ | :----------------------------------------------------------- |
| USER    | 该进程是由哪个用户创建的                                     |
| PID     | 进程的ID号                                                   |
| %CPU    | 该进程占用CPU资源的百分比，占用越高说明越消耗系统资源        |
| %MEM    | 该进程占用物理内存的百分比，占用越高说明越消耗系统资源       |
| VSZ     | 该进程占用虚拟内存的百分比，单位是KB                         |
| RSS     | 该进程占用实际物理内存大小，单位是KB                         |
| TTY     | 该进程在哪个终端中运行。tty1~tty7表示本地控制终端，tty1~tty6是字符终端，tty7是图形终端。pts/0~255代表虚拟终端，?表示此终端是系统启动的 |
| STAT    | 进程状态                                                     |
| START   | 该进程的启动时间                                             |
| TIME    | 该进程占用CPU的运算时间,数值越高说明越消耗系统资源           |
| COMMAND | 产生此进程的命令名                                           |

#### 1.2.3 进程状态(STAT)

| 参数          | 含义       |
| :------------ | :--------- |
| R(Runing)     | 运行       |
| S(Sleep)      | 休眠       |
| T(Terminated) | 停止       |
| S(Son)        | 包含子进程 |
| +             |            |

### 1.3 pstree 显示进程树

- pstree [选项]
  - -p 显示进程PID
  - -u 显示进程的所属用户

### 1.3 进程的查看(top) [#](http://zhufengpeixun.com/strong/html/61.7.devops-system.html#t81.3 进程的查看(top))

- top 可以查看到所有的进程以及对系统资源的分析

```js
 top -b -n 1 > top.txt
```

#### 1.3.1 选项

| 选项 | 含义                                                |
| :--- | :-------------------------------------------------- |
| -b   | 使用批处理模式输出，一般和`-n`配合使用              |
| -n   | 次数，指定top命令执行的次数。一般了`-b`选项配合使用 |
| -d   | 秒数，指定top命令每隔几秒更新。默认是3秒            |

#### 1.3.2 交互模式的命令

| 选项 | 含义                            |
| :--- | :------------------------------ |
| ?或h | 显示交互模式的帮助              |
| P    | 按CPU使用率排序，默认就是此选项 |
| M    | 以内存的使用率排序              |
| N    | 以PID排序                       |
| q    | 退出top                         |

#### 1.3.3 状态栏

##### 1.3.3.1 第一行为任务队列信息

| 内容               | 说明                                                         |
| :----------------- | :----------------------------------------------------------- |
| 12:12:12           | 系统的当前时间                                               |
| up 1 day 5:33      | 系统的运行时间，本机已经运行了1天5小时33分                   |
| 2 users            | 当前登录了二个客户端                                         |
| load average 0 0 0 | 系统在之前1分钟、5分钟、15分钟的平均负载。一般认为小于1小时负载较小，大于1超过负载 |

##### 1.3.3.2 第二行为进程信息

| 内容             | 说明                              |
| :--------------- | :-------------------------------- |
| Tasks: 100 total | 系统中的进程总数                  |
| 1 running        | 正在运行的进程数                  |
| 94 sleeping      | 睡眠的进程                        |
| 0 stopped        | 正在停止的进程                    |
| 0 zombie         | 僵尸进程。如果不是0的话要进行检查 |

##### 1.3.3.3 第三行为CPU信息

| 内容           | 说明                                   |
| :------------- | :------------------------------------- |
| Cpu(s): 0.1%us | 用户模式占用的CPU百分比                |
| 0.1%sy         | 系统模式占用的CPU百分比                |
| 0.0%ni         | 改变过优先级的用户进程 占用的CPU百分比 |
| 99.7%id        | 空闲CPU的CPU百分比                     |
| 0.1%wa         | 等待输入/输出的进程的占用CPU百分比     |
| 0.1%hi         | 硬中断请求服务占用的CPU百分比          |
| 0.1%si         | 软中断请求服务占用的CPU百分比          |
| 0.0%st         | st(Steal time)虚拟时间百分比，就是当有 |

##### 1.3.3.4 第四行为物理内存信息 [#](http://zhufengpeixun.com/strong/html/61.7.devops-system.html#t151.3.3.4 第四行为物理内存信息)

| 内容                | 说明                                                         |
| :------------------ | :----------------------------------------------------------- |
| Mem: 1030720k total | 物理内存的问题，单位是KB                                     |
| 551860k used        | 已经使用的物理内存数量                                       |
| 478860k free        | 空闲的物理内存数量，虚拟机分配了1024M内存，使用了538M,空闲467M |
| 43180k buffers      | 作为缓冲的内存数量，可以存放需要写入硬盘的数据，用来加速数据的写入 |

##### 1.3.3.5 第四行为交换分区信息

| 内容                 | 说明                                                   |
| :------------------- | :----------------------------------------------------- |
| Swap: 2047992k total | 总计的交换分区(虚拟内存)大小                           |
| 536k used            | 已经使用的交换分区大小                                 |
| 2047456k free        | 空闲的交换分区大小                                     |
| 368164k cached       | 把需要经常读取的数据从硬盘读到内存中，加速了数据的读取 |

### 1.4 杀死进程(kill)

| 信号 代码 | 信号名称 | 说明                                                         | 示例                |
| :-------- | :------- | :----------------------------------------------------------- | :------------------ |
| 1         | SIGHUP   | 该信号让进程立即关闭，然后重写读取配置文件后重启,平滑重启    | kill -1 -HUP 进程号 |
| 2         | SIGINT   | 程序终止信号，用于关闭前台进程,相当于ctrl+c                  |                     |
| 9         | SIGKILL  | 用来立刻结束程序的运行，本信号不能阻塞、处理和忽略，一般用于强制中止 |                     |
| 15        | SIGTERM  | 正常结束进程的信号，kill命令的默认信号。如果不能正常中止，才会尝试SIGKILL信号 |                     |

#### 1.4.2 杀死单一进程

```shell
kill -9 进程号
```

#### 1.4.3 killall

- 按照进程名杀死进程
- killall [选项][信号] 进程名
  - -i 交互式，询问是否要杀死某个进程
  - -I 进程名忽略大小写
- /etc/httpd/conf/httpd.conf
  - ServerName localhost:80

#### 1.4.4 pkill

- 按照进程名杀死进程
- pkill [选项][信号] 进程名 

```js
pkill -9 nginx
```

#### 1.4.5 w

| 选项   | 含义                                                         |
| :----- | :----------------------------------------------------------- |
| USER   | 显示登陆用户帐号名                                           |
| TTY    | 用户登陆所用的终端                                           |
| FROM   | 显示用户在何处登陆系统                                       |
| LOGIN@ | 是LOGIN AT的意思，表示登陆进入系统的时间                     |
| IDLE   | 用户空闲时间，从用户上一次任务结束后，开始记时               |
| JCPU   | 终端代号来区分，表示在这段时间内，所有与该终端相关的进程任务所耗费的CPU时间 |
| PCPU   | 指WHAT域的任务执行后耗费的CPU时间                            |
| WHAT   | 表示当前执行的任务                                           |

### 1.5 free 查看内存使用状态

- 查看内存使用状态

```shell
# free -m
             total       used       free     shared    buffers     cached
Mem:          1006        687        319          0         98        449
-/+ buffers/cache:        139        866
Swap:         1999          0       1999
```

#### 1.5.1 第一行 [#](http://zhufengpeixun.com/strong/html/125.7.linux-system.html#t292.3.1 第一行)

| 分类    | 参数                 | 含义 |
| :------ | :------------------- | :--- |
| total   | 内存总数             |      |
| used    | 已经使用的内存数     |      |
| free    | 空闲的内存数         |      |
| shared  | 多个进程共享的内存数 |      |
| buffers | 缓冲区内存数         |      |
| cached  | 缓存内存数           |      |

#### 1.5.2 第三行 [#](http://zhufengpeixun.com/strong/html/125.7.linux-system.html#t312.3.3 第三行)

| 分类  | 参数                          | 含义 |
| :---- | :---------------------------- | :--- |
| total | swap总数，默认单位是K         |      |
| used  | 已经使用的swap数，默认单位是K |      |
| free  | 空闲的swap数，默认单位是K     |      |

### 1.6 查看内核相关信息

- uname

```js
# uname -a
Linux localhost 2.6.32-279.el6.i686 #1 SMP Fri Jun 22 10:59:55 UTC 2012 i686 i686 i386 GNU/Linux
# uname -s
Linux
# uname -r
2.6.32-279.el6.i686
```

### 1.7 查看操作系统位数 [#](http://zhufengpeixun.com/strong/html/125.7.linux-system.html#t332.7 查看操作系统位数)

```js
file /bin/ls
```

### 1.8 查看发行版本

```js
lsb_release -a
```

### 1.9 查看发行版本

```js
yum install redhat-lsb -y
lsb_release -v
```

## 2.rpm 包管理器

- RPM是Red Hat公司随Redhat Linux推出了一个软件包管理器，通过它能够更加轻松容易地实现软件的安装
-  软件安装包通常是一个RPM包（Redhat Linux Packet Manager，就是Redhat的包管理器），后缀是.rpm 

### 2.1 rpm命令

| 用途                               | 命令                    |
| :--------------------------------- | :---------------------- |
| 安装软件                           | 执行`rpm -ivh rpm`包名  |
| 升级软件                           | 执行`rpm -Uvh rpm`包名  |
| 反安装                             | 执行`rpm -e rpm`包名    |
| 查询软件包的详细信息               | 执行`rpm -qpi rpm`包名  |
| 查询某个文件是属于那个rpm包的      | 执行`rpm -qf rpm`包名   |
| 查该软件包会向系统里面写入哪些文件 | 执行 `rpm -qpl rpm`包名 |

-  其中`i`表示安装install，`v`表示显示安装过程verbose，`h`表示显示进度 
-  U表示升级update 
- 一般不用,会有问题

### 2.2 repo

- repo文件是yum源（软件仓库）的配置文件，通常一个repo文件定义了一个或者多个软件仓库的细节内容，例如我们将从哪里下载需要安装或者升级的软件包，repo文件中的设置内容将被yum读取和应用
- 服务器端：在服务器上面存放了所有的RPM软件包，然后以相关的功能去分析每个RPM文件的依赖性关系，将这些数据记录成文件存放在服务器的某特定目录内。
- 客户端：如果需要安装某个软件时，先下载服务器上面记录的依赖性关系文件(可通过WWW或FTP方式)，通过对服务器端下载的纪录数据进行分析，然后取得所有相关的软件，一次全部下载下来进行安装。

### 2.3 RPM包的默认安装位置

| 文件           | 含义                   |
| :------------- | :--------------------- |
| /etc           | 配置文件位置           |
| /etc/init.d    | 启动脚本位置           |
| /etc/sysconfig | 初始化环境配置文件位置 |
| /var/lib       | 服务产生的数据放在这里 |
| /var/log       | 日志                   |

## 3 yum 包管理器

```shell
yum install -y nginx 
systemctl start nginx.service
```

## 4. 源码安装

```shell
wget https://img.zhufengpeixun.com/nginx-1.10.1.tar.gz
tar -zxvf nginx-1.10.1.tar.gz  // 解压
cd nginx-1.10.1
./configure      // 编译配置
make && make install // 安装
```

## 5. 防火墙

| 操作           | 命令                     |
| :------------- | :----------------------- |
| 查询防火墙状态 | service iptables status  |
| 停止防火墙     | service iptables stop    |
| 启动防火墙     | service iptables start   |
| 重启防火墙     | service iptables restart |
| 永久关闭防火墙 | chkconfig iptables off   |
| 永久关闭后启用 | chkconfig iptables on    |
| 查看防火墙状态 | service iptables status  |

## 6. 网络

### 6.1 ifconfig临时配置IP

```shell
ifconfig
```

### 6.2 查询网络状态

- netstat 选项

| 选项 | 含义                                     |
| :--- | :--------------------------------------- |
| -t   | 列出TCP协议端口                          |
| -u   | 列出UDP协议端口                          |
| -n   | 不使用域名与服务名，而使用IP地址和端口号 |
| -l   | 仅列出在监听状态网络服务                 |
| -a   | 列出所有的网络连接                       |

```shell
netstat -tlun
netstat -an | more
netstat -unt | grep  ESTABLISHED
```

### 6.2 ping 网络测试命令

- ping [选项] ip或域名
- 测试指定IP或域名的网络状况
- 选项
  - -c 次数指定ping包的次数

```js
ping www.baidu.com -c 3
```

### 6.3 wget [#](http://zhufengpeixun.com/strong/html/125.9.linux-network.html#t64.2 wget)

- 下载命令

```js
wget http://www.baidu.com
```

### 6.4 SSH协议原理 远程登录

```shell
ssh root@120.79.158.111
/*
yes
输出密码
*/

```

#### 6.4 scp

- scp是 secure copy的缩写, scp是linux系统下基于ssh登陆进行安全的远程文件拷贝命令
- linux的scp命令可以在linux服务器之间复制文件和目录
- 命令格式 scp [参数] [原路径] [目标路径]

| 参数 | 含义             |
| :--- | :--------------- |
| -r   | 递归复制整个目录 |
| -v   | 详细方式显示输出 |

##### 6.4.1 从本地服务器复制到远程服务器

```js
scp local_file remote_username@remote_ip:remote_folder  
scp -r local_folder remote_username@remote_ip:remote_folder  
```

##### 6.4.2 从远程服务器复制到本地服务器

```js
scp  remote_username@remote_ip:remote_folder  local_file
scp -r  remote_username@remote_ip:remote_folder local_folder
```