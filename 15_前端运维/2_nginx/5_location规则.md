## 1. location

### 1.1 正则表达式

| 类型  | 种类                                                        |
| :---- | :---------------------------------------------------------- |
| .     | 匹配除换行符之外的任意字符                                  |
| ?     | 重复0次或1次                                                |
| +     | 重复1次或更多次                                             |
| *     | 重复零次或多次                                              |
| ^     | 匹配字符串的开始                                            |
| $     | 匹配字符串的结束                                            |
| {n}   | 重复n次                                                     |
| {n,}  | 重复n次或更多次                                             |
| [abc] | 匹配单个字符a或者b或者c                                     |
| a-z   | 匹配a-z小写字母的任意一个                                   |
| \     | 转义字符                                                    |
| ()    | 用于匹配括号之间的内容，可以通过$1、$2引用                  |
| \w    | 的释义都是指包含大 小写字母数字和下划线 相当于([0-9a-zA-Z]) |

### 1.2 语法规则

- location仅匹配URI，忽略参数
- 前缀字符串
  - 常规
  - = 精确匹配
  - ^~ 匹配上后则不再进行正则表达式的匹配
- 正则表达式
  - ~ 大小写敏感的正则表达式匹配
  - ~*忽略大小写的正则表达式匹配
- 内部调转
  - 用于内部跳转的命名location @

```js
Syntax location [=|~|~*|^~] uri {...}
       location @name{...}
default -
Context server,location       
```

### 1.3 匹配规则

- 等号类型（=）的优先级最高。一旦匹配成功，则不再查找其他匹配项。
- ^~类型表达式。一旦匹配成功，则不再查找其他匹配项。
- 正则表达式类型（~ ~*）的优先级次之。如果有多个location的正则能匹配的话，则使用正则表达式最长的那个。
- 常规字符串匹配类型按前缀匹配

![d27be56a55ca1247171bf85d7c25a8d6](https://img.zhufengpeixun.com/d27be56a55ca1247171bf85d7c25a8d6)

### 1.4 案例

```js
location ~ /T1/$ {
    return 200 '匹配到第一个正则表达式';
}
location ~* /T1/(\w+)$ {
    return 200 '匹配到最长的正则表达式';
}
location ^~ /T1/ {
    return 200 '停止后续的正则表达式匹配';
}
location  /T1/T2 {
    return 200 '最长的前缀表达式匹配';
}
location  /T1 {
    return 200 '前缀表达式匹配';
}
location = /T1 {
    return 200 '精确匹配';
}
/T1     //精确匹配
/T1/    //停止后续的正则表达式匹配
/T1/T2  //匹配到最长的正则表达式
/T1/T2/ //最长的前缀表达式匹配
/t1/T2  //匹配到最长的正则表达式
```